<!DOCTYPE html>
<html>
<head>
  <title>Interactive Map with Markers</title>
  <style>
    #map {
      height: 400px;
      width: 100%;
    }
  </style>
  <!-- Include Leaflet CSS and JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <h1>Water Sources Map</h1>
  <div id="map"></div>

  <script>
    var map = L.map('map').setView([47.3, 9], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    async function fetchDataFromServer(lat, lng) {
      try {
        const username = 'kazzyyy';
        const response = await fetch(`/data?lat=${lat}&lng=${lng}&username=${username}`);
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        createMarkers(data);
      } catch (error) {
        console.error('Error:', error);
      }
    }

    function createMarkers(data) {
      data.forEach(waterSource => {
        var marker = L.marker([parseFloat(waterSource.lat), parseFloat(waterSource.lng)]).addTo(map);
        var popupContent = `<h2>${waterSource.name}</h2>
                            <p><strong>Latitude:</strong> ${waterSource.lat}</p>
                            <p><strong>Longitude:</strong> ${waterSource.lng}</p>
                            <p><strong>Location:</strong> ${waterSource.toponymName}</p>`;
        marker.bindPopup(popupContent);
      });
    }

    // Example usage: Call fetchDataFromServer with latitude and longitude values
    const latitude = 47.3;
    const longitude = 9;
    fetchDataFromServer(latitude, longitude);
  </script>
</body>
</html>

